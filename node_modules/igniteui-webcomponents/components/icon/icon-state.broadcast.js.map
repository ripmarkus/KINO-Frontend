{"version":3,"file":"icon-state.broadcast.js","sourceRoot":"","sources":["../../../src/components/icon/icon-state.broadcast.ts"],"names":[],"mappings":"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","sourcesContent":["import { createIconDefaultMap } from './registry/default-map.js';\nimport type {\n  BroadcastIconsChangeMessage,\n  IconMeta,\n  IconsCollection,\n  SvgIcon,\n} from './registry/types.js';\nimport { ActionType } from './registry/types.js';\n\nexport class IconsStateBroadcast {\n  private channel!: BroadcastChannel | null;\n  private collections: IconsCollection<SvgIcon>;\n  private refsCollection: IconsCollection<IconMeta>;\n  private static readonly origin = 'igniteui-webcomponents';\n\n  constructor(\n    collections: IconsCollection<SvgIcon>,\n    refsCollection: IconsCollection<IconMeta>\n  ) {\n    this.collections = collections;\n    this.refsCollection = refsCollection;\n    this.create();\n\n    globalThis.addEventListener('pageshow', () => this.create());\n    globalThis.addEventListener('pagehide', () => this.dispose());\n  }\n\n  public send(data: BroadcastIconsChangeMessage) {\n    if (this.channel) {\n      this.channel.postMessage(data);\n    }\n  }\n\n  public handleEvent({ data }: MessageEvent<BroadcastIconsChangeMessage>) {\n    // no need to sync with other wc icon services, just with angular elements\n    if (\n      data.actionType !== ActionType.SyncState ||\n      data.origin === IconsStateBroadcast.origin\n    ) {\n      return;\n    }\n\n    this.send({\n      actionType: ActionType.SyncState,\n      collections: this.getUserSetCollection(this.collections).toMap(),\n      references: this.getUserRefsCollection(this.refsCollection).toMap(),\n      origin: IconsStateBroadcast.origin,\n    });\n  }\n\n  private create() {\n    if (!this.channel) {\n      this.channel = new BroadcastChannel('ignite-ui-icon-channel');\n      this.channel.addEventListener('message', this);\n    }\n  }\n\n  /* c8 ignore next 7 */\n  private dispose() {\n    if (this.channel) {\n      this.channel.removeEventListener('message', this);\n      this.channel.close();\n      this.channel = null;\n    }\n  }\n\n  private getUserRefsCollection(collections: IconsCollection<IconMeta>) {\n    const userSetIcons = createIconDefaultMap<string, IconMeta>();\n    for (const [collectionKey, collection] of collections.entries()) {\n      for (const [iconKey, icon] of collection.entries()) {\n        if (icon.external) {\n          userSetIcons.getOrCreate(collectionKey).set(iconKey, icon);\n        }\n      }\n    }\n    return userSetIcons;\n  }\n\n  private getUserSetCollection(collections: IconsCollection<SvgIcon>) {\n    const userSetIcons = createIconDefaultMap<string, SvgIcon>();\n\n    for (const [collectionKey, collection] of collections.entries()) {\n      if (collectionKey === 'internal') {\n        continue;\n      }\n      for (const [iconKey, icon] of collection.entries()) {\n        userSetIcons.getOrCreate(collectionKey).set(iconKey, icon);\n      }\n    }\n    return userSetIcons;\n  }\n}\n"]}